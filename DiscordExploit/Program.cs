using Discord;
using Discord.Gateway;
using Discord.Voice;
using System;
using System.Threading;
using Console = Colorful.Console;
using System.Drawing;


namespace DiscordExploit
{
    class Program
    {
        static void Main()
        {
            DiscordSocketClient client = new DiscordSocketClient();
            client.OnLoggedIn += client_OnLoggedIn;

            Console.WriteLine(string.Empty);
            Console.WriteLine(" Made by Manono", Color.DeepPink);
            Console.WriteLine(" https://github.com/vManono", Color.DeepPink);

            Console.WriteAscii("Voice Channel Exploit", Color.DeepPink);
            Console.Write(" Paste token: ", Color.DeepPink);
            client.Login(Console.ReadLine());

            Thread.Sleep(-1);
        }

        public static void client_OnLoggedIn(DiscordSocketClient client, LoginEventArgs args)
        {
            
            Console.WriteLine("Logged in", Color.DeepPink);

            ulong guildID = 0;
            ulong channelID = 0;

            
            Console.WriteLine(@"Input sound path example: C:\Users\Manono\Downloads\sound.mp3", Color.DeepPink);

            Console.Write("Enter your song path: ", Color.DeepPink);
            string soundLocation =  Console.ReadLine();
            Console.WriteLine(string.Empty);

            Console.Write("Enter guildID: ", Color.DeepPink);
            guildID = Convert.ToUInt64(Console.ReadLine());
            Console.WriteLine(string.Empty);

            Console.Write("Enter channelID: ", Color.DeepPink);
            channelID = Convert.ToUInt64(Console.ReadLine());
            Console.WriteLine(string.Empty);

            byte[] audio = DiscordVoiceUtils.ReadFromFile(soundLocation);
            var session = client.JoinVoiceChannel(guildID, channelID, true, true);
            session.OnConnected += (s, a) =>
            {
                Console.Write("Should be working now?", Color.DeepPink);

                var stream = session.CreateStream(64000);

                session.SetSpeakingState(DiscordVoiceSpeakingState.Soundshare);

                while (true)
                    stream.CopyFrom(audio);
            };
        }
    }
}